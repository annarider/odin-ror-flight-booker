<h1>Flight Booker</h1>

<%= form_with url: flights_path, method: :get, local: true do |form| %>
  <div>
    <%= form.label :departure_airport_id, 'From:' %>
    <%= form.collection_select :departure_airport_id, @airports, :id, :code, { include_blank: 'Select departure airport', selected: params[:departure_airport_id] } %>
  </div>

  <div>
    <%= form.label :arrival_airport_id, 'To:' %>
    <%= form.collection_select :arrival_airport_id, @airports, :id, :code, { include_blank: 'Select arrival airport', selected: params[:arrival_airport_id] } %>
  </div>

  <div>
    <%= form.label :num_passengers, 'Number of passengers:' %>
    <%= form.select :num_passengers, (1..4).to_a, { selected: 1, selected: params[:num_passengers] } %>
  </div>

  <div>
    <%= form.label :start, 'Date:' %>
    <%= form.select :start,
                        options_for_select(@available_dates.map { |date| [date.strftime('%B %d, %Y'), date] }, params[:start]),
                        { include_blank: 'Select a date'} %>
  </div>

  <%= form.submit 'Search Flights' %>
<% end %>

<% if @flights.any? %>
  <h2>Available Flights</h2>
  <% @flights.each do |flight| %>
    <div>
      <p>
        <strong><%= flight.departure_airport.code %></strong> to <strong><%= flight.arrival_airport.code %></strong>
        (date: <%= flight.start.strftime('%B %d, %Y') %>).
        Duration: <%= flight.duration %> minutes
      </p>
    </div>
  <% end %>
<% else %>
  <p><strong>No flights available for your selected criteria.</strong></p>
  <p>Try searching again with different criteria.</p>
<% end %>
